"use strict";(()=>{var e={};e.id=240,e.ids=[240],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},25528:e=>{e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},11577:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>g,originalPathname:()=>y,patchFetch:()=>x,requestAsyncStorage:()=>v,routeModule:()=>m,serverHooks:()=>w,staticGenerationAsyncStorage:()=>f,staticGenerationBailout:()=>E});var a={};t.r(a),t.d(a,{POST:()=>p});var s=t(95419),i=t(69108),n=t(99678),o=t(78070),u=t(81355),d=t(3205),l=t(9108);let c={"VIXT-ER20-24VP-DEMO":{type:"VP",amount:100,used:!1},"WELC-OME5-0VBP-FREE":{type:"VBP",amount:50,used:!1},"BETA-TEST-100V-P123":{type:"VP",amount:200,used:!1},"DAIL-Y10V-BP50-GIFT":{type:"VBP",amount:25,used:!1}};async function p(e){try{let r=await (0,u.getServerSession)(d.L);if(!r?.user?.id)return o.Z.json({error:"Unauthorized"},{status:401});let{code:t}=await e.json();if(!t||"string"!=typeof t)return o.Z.json({error:"Invalid code format"},{status:400});let a=t.replace(/\s+/g,"").toUpperCase(),s=c[a];if(!s)return o.Z.json({error:"C\xf3digo inv\xe1lido"},{status:400});if(s.used)return o.Z.json({error:"C\xf3digo j\xe1 foi utilizado"},{status:400});if(await l._.transaction.findFirst({where:{receiverId:r.user.id,type:"REDEEM_CODE",description:{contains:a}}}))return o.Z.json({error:"Voc\xea j\xe1 resgatou este c\xf3digo"},{status:400});let i=await l._.wallet.findUnique({where:{userId:r.user.id}});i||(i=await l._.wallet.create({data:{userId:r.user.id,vpBalance:0,vcBalance:0,vbpBalance:0,vcPendingBalance:0}}));let n={},p="";switch(s.type){case"VP":n.vpBalance={increment:s.amount},p="vpBalance";break;case"VC":n.vcBalance={increment:s.amount},p="vcBalance";break;case"VBP":n.vbpBalance={increment:s.amount},p="vbpBalance";break;default:return o.Z.json({error:"Invalid code type"},{status:400})}let m=await l._.wallet.update({where:{userId:r.user.id},data:n});return await l._.transaction.create({data:{receiverId:r.user.id,amount:s.amount,currency:s.type,type:"REDEEM_CODE",status:"COMPLETED",description:`C\xf3digo resgatado: ${a} - ${s.amount} ${s.type}`}}),s.used=!0,o.Z.json({success:!0,amount:s.amount,currency:s.type,newBalance:Number(m[p]),message:`C\xf3digo resgatado com sucesso! Voc\xea ganhou ${s.amount} ${s.type}!`})}catch(e){return console.error("Error redeeming code:",e),o.Z.json({error:"Internal server error"},{status:500})}}let m=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/wallet/redeem-code/route",pathname:"/api/wallet/redeem-code",filename:"route",bundlePath:"app/api/wallet/redeem-code/route"},resolvedPagePath:"D:\\Vixter\\vixter-next\\app\\api\\wallet\\redeem-code\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:v,staticGenerationAsyncStorage:f,serverHooks:w,headerHooks:g,staticGenerationBailout:E}=m,y="/api/wallet/redeem-code/route";function x(){return(0,n.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:f})}},3205:(e,r,t)=>{t.d(r,{L:()=>d});var a=t(54896),s=t(10375),i=t(86485),n=t(6521),o=t.n(n),u=t(9108);let d={adapter:(0,a.N)(u._),providers:[...process.env.GOOGLE_CLIENT_ID&&process.env.GOOGLE_CLIENT_SECRET?[(0,s.Z)({clientId:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET,authorization:{params:{prompt:"consent",access_type:"offline",response_type:"code"}}})]:[],(0,i.Z)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let r=await u._.user.findFirst({where:{OR:[{email:e.email},{username:e.email}]},include:{profile:!0}});return r&&r.password&&await o().compare(e.password,r.password)?{id:r.id,email:r.email,name:r.name,image:r.image||r.profile?.avatarUrl,username:r.username||void 0,verified:r.verified}:null}})],session:{strategy:"jwt"},callbacks:{async jwt({token:e,user:r,account:t}){if(r&&(e.username=r.username,e.verified=r.verified),t?.provider==="google"&&r){let e=await u._.user.findUnique({where:{id:r.id},include:{profile:!0}});e&&!e.profile&&await u._.profile.create({data:{userId:r.id,bio:"",avatarUrl:r.image}})}return e},session:async({session:e,token:r})=>(r&&(e.user.id=r.sub,e.user.username=r.username,e.user.verified=r.verified),e)},pages:{signIn:"/auth/signin",error:"/auth/error"},secret:process.env.NEXTAUTH_SECRET||"fallback-secret-for-build"}},9108:(e,r,t)=>{t.d(r,{_:()=>s});let a=require("@prisma/client"),s=globalThis.prisma??new a.PrismaClient({log:[]})}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[638,393,206,898],()=>t(11577));module.exports=a})();