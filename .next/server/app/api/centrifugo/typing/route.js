"use strict";(()=>{var e={};e.id=469,e.ids=[469],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},25528:e=>{e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},25586:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>S,originalPathname:()=>O,patchFetch:()=>v,requestAsyncStorage:()=>m,routeModule:()=>h,serverHooks:()=>b,staticGenerationAsyncStorage:()=>T,staticGenerationBailout:()=>E});var i={};t.r(i),t.d(i,{POST:()=>y});var n=t(95419),s=t(69108),o=t(99678),a=t(78070),u=t(81355),c=t(3205),p=t(27444),l=t(9108),d=t(25252),g=t(52178);let f=d.Ry({conversationId:d.Z_(),isTyping:d.O7()});async function y(e){try{let r=await (0,u.getServerSession)(c.L);if(!r?.user)return a.Z.json({error:"Unauthorized"},{status:401});let t=await e.json(),{conversationId:i,isTyping:n}=f.parse(t);if(!await l._.conversationMember.findFirst({where:{conversationId:i,userId:r.user.id}}))return a.Z.json({error:"Forbidden"},{status:403});let s=p.Ky.typing(i),o={type:n?p.O8.TYPING_START:p.O8.TYPING_STOP,data:{userId:r.user.id,userName:r.user.name,conversationId:i},timestamp:Date.now(),userId:r.user.id};return await p.mT.publish(s,o),a.Z.json({success:!0})}catch(e){if(e instanceof g.jm)return a.Z.json({error:"Validation error",details:e.errors},{status:400});return console.error("Error sending typing indicator:",e),a.Z.json({error:"Internal server error"},{status:500})}}let h=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/centrifugo/typing/route",pathname:"/api/centrifugo/typing",filename:"route",bundlePath:"app/api/centrifugo/typing/route"},resolvedPagePath:"D:\\Vixter\\vixter-next\\app\\api\\centrifugo\\typing\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:m,staticGenerationAsyncStorage:T,serverHooks:b,headerHooks:S,staticGenerationBailout:E}=h,O="/api/centrifugo/typing/route";function v(){return(0,o.patchFetch)({serverHooks:b,staticGenerationAsyncStorage:T})}},3205:(e,r,t)=>{t.d(r,{L:()=>c});var i=t(54896),n=t(10375),s=t(86485),o=t(6521),a=t.n(o),u=t(9108);let c={adapter:(0,i.N)(u._),providers:[(0,n.Z)({clientId:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET}),(0,s.Z)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let r=await u._.user.findFirst({where:{OR:[{email:e.email},{username:e.email}]},include:{profile:!0}});return r&&r.password&&await a().compare(e.password,r.password)?{id:r.id,email:r.email,name:r.name,image:r.image||r.profile?.avatarUrl,username:r.username||void 0,verified:r.verified}:null}})],session:{strategy:"jwt"},callbacks:{async jwt({token:e,user:r,account:t}){if(r&&(e.username=r.username,e.verified=r.verified),t?.provider==="google"&&r){let e=await u._.user.findUnique({where:{id:r.id},include:{profile:!0}});e&&!e.profile&&await u._.profile.create({data:{userId:r.id,bio:"",avatarUrl:r.image}})}return e},session:async({session:e,token:r})=>(r&&(e.user.id=r.sub,e.user.username=r.username,e.user.verified=r.verified),e)},pages:{signIn:"/auth/signin",error:"/auth/error"},secret:process.env.NEXTAUTH_SECRET}},27444:(e,r,t)=>{t.d(r,{Ky:()=>a,O8:()=>i,mT:()=>o});var i,n=t(6113);class s{constructor(e){this.config=e}generateToken(e,r=3600){let t=Math.floor(Date.now()/1e3),i=Buffer.from(JSON.stringify({typ:"JWT",alg:"HS256"})).toString("base64url"),s=Buffer.from(JSON.stringify({sub:e,iat:t,exp:t+r})).toString("base64url"),o=(0,n.createHmac)("sha256",this.config.tokenSecret).update(`${i}.${s}`).digest("base64url");return`${i}.${s}.${o}`}async publish(e,r){try{return(await fetch(`${this.config.apiUrl}/publish`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`apikey ${this.config.apiKey}`},body:JSON.stringify({channel:e,data:r})})).ok}catch(e){return console.error("Error publishing to Centrifugo:",e),!1}}async broadcast(e,r){try{return(await fetch(`${this.config.apiUrl}/broadcast`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`apikey ${this.config.apiKey}`},body:JSON.stringify({channels:e,data:r})})).ok}catch(e){return console.error("Error broadcasting to Centrifugo:",e),!1}}async subscribe(e,r){try{return(await fetch(`${this.config.apiUrl}/subscribe`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`apikey ${this.config.apiKey}`},body:JSON.stringify({user:e,channel:r})})).ok}catch(e){return console.error("Error subscribing to Centrifugo channel:",e),!1}}async unsubscribe(e,r){try{return(await fetch(`${this.config.apiUrl}/unsubscribe`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`apikey ${this.config.apiKey}`},body:JSON.stringify({user:e,channel:r})})).ok}catch(e){return console.error("Error unsubscribing from Centrifugo channel:",e),!1}}async disconnect(e){try{return(await fetch(`${this.config.apiUrl}/disconnect`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`apikey ${this.config.apiKey}`},body:JSON.stringify({user:e})})).ok}catch(e){return console.error("Error disconnecting user from Centrifugo:",e),!1}}async presence(e){try{let r=await fetch(`${this.config.apiUrl}/presence`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`apikey ${this.config.apiKey}`},body:JSON.stringify({channel:e})});if(r.ok)return await r.json();return null}catch(e){return console.error("Error getting channel presence:",e),null}}}let o=new s({apiUrl:process.env.CENTRIFUGO_API_URL,apiKey:process.env.CENTRIFUGO_API_KEY,tokenSecret:process.env.CENTRIFUGO_TOKEN_HMAC_SECRET}),a={user:e=>`user:${e}`,conversation:e=>`conversation:${e}`,typing:e=>`typing:${e}`,presence:e=>`presence:${e}`};!function(e){e.MESSAGE_SENT="message_sent",e.MESSAGE_READ="message_read",e.TYPING_START="typing_start",e.TYPING_STOP="typing_stop",e.USER_ONLINE="user_online",e.USER_OFFLINE="user_offline",e.CONVERSATION_CREATED="conversation_created",e.NOTIFICATION="notification"}(i||(i={}))},9108:(e,r,t)=>{t.d(r,{_:()=>n});let i=require("@prisma/client"),n=globalThis.prisma??new i.PrismaClient({log:["query"]})}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),i=r.X(0,[638,393,898,206,252],()=>t(25586));module.exports=i})();