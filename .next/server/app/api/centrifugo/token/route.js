"use strict";(()=>{var e={};e.id=965,e.ids=[965],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},25528:e=>{e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},97059:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>y,originalPathname:()=>T,patchFetch:()=>b,requestAsyncStorage:()=>g,routeModule:()=>d,serverHooks:()=>h,staticGenerationAsyncStorage:()=>f,staticGenerationBailout:()=>m});var i={};t.r(i),t.d(i,{POST:()=>l});var n=t(95419),o=t(69108),s=t(99678),a=t(78070),u=t(81355),c=t(3205),p=t(27444);async function l(e){try{let e=await (0,u.getServerSession)(c.L);if(!e?.user)return a.Z.json({error:"Unauthorized"},{status:401});let r=p.mT.generateToken(e.user.id);return a.Z.json({token:r,user:{id:e.user.id,name:e.user.name,username:e.user.username}})}catch(e){return console.error("Error generating Centrifugo token:",e),a.Z.json({error:"Internal server error"},{status:500})}}let d=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/centrifugo/token/route",pathname:"/api/centrifugo/token",filename:"route",bundlePath:"app/api/centrifugo/token/route"},resolvedPagePath:"D:\\Vixter\\vixter-next\\app\\api\\centrifugo\\token\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:g,staticGenerationAsyncStorage:f,serverHooks:h,headerHooks:y,staticGenerationBailout:m}=d,T="/api/centrifugo/token/route";function b(){return(0,s.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:f})}},3205:(e,r,t)=>{t.d(r,{L:()=>c});var i=t(54896),n=t(10375),o=t(86485),s=t(6521),a=t.n(s),u=t(9108);let c={adapter:(0,i.N)(u._),providers:[(0,n.Z)({clientId:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET}),(0,o.Z)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let r=await u._.user.findFirst({where:{OR:[{email:e.email},{username:e.email}]},include:{profile:!0}});return r&&r.password&&await a().compare(e.password,r.password)?{id:r.id,email:r.email,name:r.name,image:r.image||r.profile?.avatarUrl,username:r.username||void 0,verified:r.verified}:null}})],session:{strategy:"jwt"},callbacks:{async jwt({token:e,user:r,account:t}){if(r&&(e.username=r.username,e.verified=r.verified),t?.provider==="google"&&r){let e=await u._.user.findUnique({where:{id:r.id},include:{profile:!0}});e&&!e.profile&&await u._.profile.create({data:{userId:r.id,bio:"",avatarUrl:r.image}})}return e},session:async({session:e,token:r})=>(r&&(e.user.id=r.sub,e.user.username=r.username,e.user.verified=r.verified),e)},pages:{signIn:"/auth/signin",error:"/auth/error"},secret:process.env.NEXTAUTH_SECRET}},27444:(e,r,t)=>{t.d(r,{Ky:()=>a,O8:()=>i,mT:()=>s});var i,n=t(6113);class o{constructor(e){this.config=e}generateToken(e,r=3600){let t=Math.floor(Date.now()/1e3),i=Buffer.from(JSON.stringify({typ:"JWT",alg:"HS256"})).toString("base64url"),o=Buffer.from(JSON.stringify({sub:e,iat:t,exp:t+r})).toString("base64url"),s=(0,n.createHmac)("sha256",this.config.tokenSecret).update(`${i}.${o}`).digest("base64url");return`${i}.${o}.${s}`}async publish(e,r){try{return(await fetch(`${this.config.apiUrl}/publish`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`apikey ${this.config.apiKey}`},body:JSON.stringify({channel:e,data:r})})).ok}catch(e){return console.error("Error publishing to Centrifugo:",e),!1}}async broadcast(e,r){try{return(await fetch(`${this.config.apiUrl}/broadcast`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`apikey ${this.config.apiKey}`},body:JSON.stringify({channels:e,data:r})})).ok}catch(e){return console.error("Error broadcasting to Centrifugo:",e),!1}}async subscribe(e,r){try{return(await fetch(`${this.config.apiUrl}/subscribe`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`apikey ${this.config.apiKey}`},body:JSON.stringify({user:e,channel:r})})).ok}catch(e){return console.error("Error subscribing to Centrifugo channel:",e),!1}}async unsubscribe(e,r){try{return(await fetch(`${this.config.apiUrl}/unsubscribe`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`apikey ${this.config.apiKey}`},body:JSON.stringify({user:e,channel:r})})).ok}catch(e){return console.error("Error unsubscribing from Centrifugo channel:",e),!1}}async disconnect(e){try{return(await fetch(`${this.config.apiUrl}/disconnect`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`apikey ${this.config.apiKey}`},body:JSON.stringify({user:e})})).ok}catch(e){return console.error("Error disconnecting user from Centrifugo:",e),!1}}async presence(e){try{let r=await fetch(`${this.config.apiUrl}/presence`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`apikey ${this.config.apiKey}`},body:JSON.stringify({channel:e})});if(r.ok)return await r.json();return null}catch(e){return console.error("Error getting channel presence:",e),null}}}let s=new o({apiUrl:process.env.CENTRIFUGO_API_URL,apiKey:process.env.CENTRIFUGO_API_KEY,tokenSecret:process.env.CENTRIFUGO_TOKEN_HMAC_SECRET}),a={user:e=>`user:${e}`,conversation:e=>`conversation:${e}`,typing:e=>`typing:${e}`,presence:e=>`presence:${e}`};!function(e){e.MESSAGE_SENT="message_sent",e.MESSAGE_READ="message_read",e.TYPING_START="typing_start",e.TYPING_STOP="typing_stop",e.USER_ONLINE="user_online",e.USER_OFFLINE="user_offline",e.CONVERSATION_CREATED="conversation_created",e.NOTIFICATION="notification"}(i||(i={}))},9108:(e,r,t)=>{t.d(r,{_:()=>n});let i=require("@prisma/client"),n=globalThis.prisma??new i.PrismaClient({log:["query"]})}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),i=r.X(0,[638,393,898,206],()=>t(97059));module.exports=i})();